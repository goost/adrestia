---
- hosts: all
    remote_user: root #should be root on fresh install with no other user
    become: true
    gather_facts: false #fact gathering depends on python
    tasks:
    - name: Check for Python
        raw: test -e /usr/bin/python3
        changed_when: false
        failed_when: false
        register: check_python
    # This only works for debian/apt based systems
    - name: Install Python
        raw: apt -y update && apt install -y python3-minimal
        when: check_python.rc != 0
    
    # CentOS and Ubuntu support in one
    #- name: Install Python
    #  raw: test -e /usr/bin/apt && (apt -y update && apt install -y python3-minimal) || (yum -y install python3 libselinux-python3)
    #  when: check_python.rc != 0